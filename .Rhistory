plot_theme()
}
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows()
f_dir %>%
list.files(full.names = T, pattern = 'err.p')
f_dir %>%
list.files(full.names = T, pattern = 'err.p')[[1]]
f_dir %>%
list.files(full.names = T, pattern = 'err.p') ->a
a[[1]]
a[[1]] -> a
f = a
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
)
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
)
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
-c('rowid', 'train', 'test'),
strip_text
) %>%
dplyr::mutate(
epochs = max(rowid),
rowid = rowid + (epochs * rerun)
)
strip_text = function(x) {
x %>%
stringr::str_split('-') %>%
lapply(magrittr::extract, -1)
}
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime', 'rmFeatures', 'init', 'rerun', 'fType'),
strip_text
)
strip_text = function(x) {
x %>%
stringr::str_split('-') %>%
lapply(magrittr::extract, -1) %>%
unlist()
}
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime', 'rmFeatures', 'init', 'rerun', 'fType'),
strip_text
)
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'rerun'), as.numeric
)
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'rerun'), as.numeric
) %>%
dplyr::mutate(
epochs = max(rowid),
rowid = rowid + (epochs * rerun)
)
f
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks))
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'rerun'), as.numeric
) %>%
dplyr::mutate(
epochs = max(rowid),
rowid = rowid + (epochs * rerun)
)
list.files(f_dir, full.names = T)
f = "/Users/colinbrust/projects/DroughtCast/data/model_results/lt_all//epochs-50_batch-1024_nMonths-25_hiddenSize-1024_leadTime-all_remove-True_init-True_rr-1_fType-err.p"
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'rerun'), as.numeric
) %>%
dplyr::mutate(
epochs = max(rowid),
rowid = rowid + (epochs * rerun)
)
read_file <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'rerun'), as.numeric
)
}
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
tidyr::pivot_longer(c(train, test), names_to='set')
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::group_by(rerun) %>%
dplyr::mutate(epochs = max(rowid))
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::group_by(rerun) %>%
dplyr::mutate(epochs = max(rowid))
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid)
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
tibble::rowid_to_column()
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column()
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
plot_all <- function(f_dir='~/projects/DroughtCast/data/model_results/convlstm') {
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
}
plot_all()
f_dir='~/projects/DroughtCast/data/model_results/convlstm'
f_dir %>%
list.files(full.names = T, pattern = 'err.p')
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file)
f_dir %>%
list.files(full.names = T, pattern = 'err.p') -> a
a
f = a
read_pickle(f)
read_pickle(f) %>%
lapply(function(x) lapply(x,mean))
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column()
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f))
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
# tidyr::separate(
#   f,
#   c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
#     'rmFeatures', 'init', 'rerun', 'fType'),
#   sep='_'
# ) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize'), as.numeric
)
read_file <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
# tidyr::separate(
#   f,
#   c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
#     'rmFeatures', 'init', 'rerun', 'fType'),
#   sep='_'
# ) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize'), as.numeric
)
}
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
# dplyr::arrange(rerun, rowid) %>%
# dplyr::select(-rowid) %>%
# tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
f_dir %>%
list.files(full.names = T, pattern = 'err.p')
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
magrittr::extract(4) %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
# dplyr::arrange(rerun, rowid) %>%
# dplyr::select(-rowid) %>%
# tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
plot_all <- function(f_dir='~/projects/DroughtCast/data/model_results/lt_all/') {
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
magrittr::extract(4) %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
# dplyr::arrange(rerun, rowid) %>%
# dplyr::select(-rowid) %>%
# tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
}
plot_all
plot_all()
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
library(reticulate)
library(magrittr)
library(ggplot2)
use_condaenv("gee", conda = "/opt/miniconda3/bin/conda")
source_python('~/projects/DroughtCast/crdm/utils/ReadPickle.py')
source('https://raw.githubusercontent.com/colinbrust/DroughtCast/revert/crdm/R/PlotTheme.R')
strip_text = function(x) {
x %>%
stringr::str_split('-') %>%
lapply(magrittr::extract, -1) %>%
unlist()
}
read_file <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
tidyr::separate(
f,
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'),
sep='_'
) %>%
dplyr::select(-dplyr::starts_with('drop')) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'leadTime',
'rmFeatures', 'init', 'rerun', 'fType'), strip_text
) %>%
dplyr::mutate_at(
c('epochs', 'batch', 'nWeeks', 'hiddenSize', 'rerun'), as.numeric
)
}
plot_all <- function(f_dir='~/projects/DroughtCast/data/model_results/lt_all/') {
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
}
plot_all()
install.packages('torchj')
install.packages('torch')
install.packages('torch')
install.packages('torch')
