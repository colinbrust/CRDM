dplyr::filter(set == 'test') %>%
ggplot(aes(x=epoch, y=err, color=model_id)) +
geom_line()
metadata
library(reticulate)
library(magrittr)
library(ggplot2)
use_condaenv("gee", conda = "/opt/miniconda3/bin/conda")
source_python('~/projects/DroughtCast/crdm/utils/ReadPickle.py')
source('https://raw.githubusercontent.com/colinbrust/DroughtCast/revert/crdm/R/PlotTheme.R')
read_metadata <- function(f) {
read_pickle(f) %>%
lapply(function(x) paste(x, collapse=', ')) %>%
tibble::as_tibble() %>%
dplyr::mutate(across(!dplyr::starts_with('feats'), as.numeric)) %>%
dplyr::mutate(model_id = basename(dirname(f)))
}
read_error <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
dplyr::mutate(model_id = basename(dirname(f))) %>%
tibble::rowid_to_column() %>%
dplyr::rename(epoch=rowid)
}
read_all <- function(pth) {
err <-  list.files(pth, recursive = T, full.names = T, pattern = 'err.p') %>%
lapply(read_error) %>%
dplyr::bind_rows()
metadata <- list.files(
pth, recursive = T, full.names = T, pattern = 'metadata.p'
) %>%
lapply(read_metadata) %>%
dplyr::bind_rows()
dplyr::left_join(err, metadata, by='model_id')
}
plot_all <- function(pth, ...) {
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>%
ggplot(aes(x=epoch, y=err, color=model_id)) +
geom_line()
}
read_file <- function() {
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
}
plot_all <- function(f_dir='~/projects/DroughtCast/data/model_results/unet/crop16/') {
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
}
pth = '~/projects/DroughtCast/data/model_results/tcn'
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>%
ggplot(aes(x=epoch, y=err, color=model_id)) +
geom_line()
dplyr::filter(set == 'test') %>%
dplyr::slice(which.min(err))
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>%
dplyr::slice(which.min(err))
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'train') %>%
ggplot(aes(x=epoch, y=err, color=model_id)) +
geom_line()
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>%
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>% dplyr::group_by(model_id) %>% dplyr::mutate(err = mean(err)) %>% dplyr::distinct()
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err))
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err)) %>% View()
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err)) %>% View()
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err))
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'test') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err)) -> a
View(a)
a
View(a)
a
tail(a)
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'train') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err)) -> a
a
metadata <- list.files(
pth, recursive = T, full.names = T, pattern = 'metadata.p'
) %>%
lapply(read_metadata) %>%
dplyr::bind_rows()
metadata
dplyr::full_join(metadata, a, 'model_id')
err
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'train') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err), model_id = unique(model_id)) -> a
dplyr::full_join(metadata, a, 'model_id')
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'train') %>% dplyr::group_by(model_id) %>% dplyr::summarise(err = mean(err), model_id = paste0('model', unique(model_id))) -> a
dplyr::full_join(metadata, a, 'model_id')
dplyr::full_join(metadata, a, 'model_id') %>% View()
dplyr::full_join(metadata, a, 'model_id') %>% as.data.frame()
dplyr::full_join(metadata, a, 'model_id') %>% dplyr::arrange(err) %>% as.data.frame()
readr::read_csv('/Users/colinbrust/projects/DroughtCast/data/in_features/memmap/smart/mei.csv')
raster::raster('./scratch/20070102_preds.tif') %>% raster::plot()
library(magrittr)
raster::raster('./scratch/20070102_preds.tif') %>% raster::plot()
raster::stack('./scratch/20070102_preds.tif') %>% raster::plot()
raster::stack('./scratch/20070102_targets.tif') %>% raster::plot()
raster::stack('./scratch/20070102_preds.tif') %>% raster::plot()
raster::stack('./scratch/20070522_preds.tif') %>% raster::plot()
raster::stack('./scratch/20070522_targets.tif') %>% raster::plot()
raster::stack('./scratch/20070102_preds.tif_preds.tif') %>% raster::plot()
raster::stack('./scratch/20070102_preds.tif') %>% raster::plot()
fs <- list.files('~/projects/DroughtCast/data/models/lstm', full.names = T, pattern = 'err')
fs
library(reticulate)
library(magrittr)
library(ggplot2)
use_condaenv("gee", conda = "/opt/miniconda3/bin/conda")
source_python('~/projects/DroughtCast/crdm/utils/ReadPickle.py')
source('https://raw.githubusercontent.com/colinbrust/DroughtCast/revert/crdm/R/PlotTheme.R')
read_metadata <- function(f) {
read_pickle(f) %>%
lapply(function(x) paste(x, collapse=', ')) %>%
tibble::as_tibble() %>%
dplyr::mutate(across(!dplyr::starts_with('feats'), as.numeric)) %>%
dplyr::mutate(model_id = basename(dirname(f)))
}
read_error <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
dplyr::mutate(model_id = basename(dirname(f))) %>%
tibble::rowid_to_column() %>%
dplyr::rename(epoch=rowid)
}
read_all <- function(pth) {
err <-  list.files(pth, recursive = T, full.names = T, pattern = 'err.p') %>%
lapply(read_error) %>%
dplyr::bind_rows()
metadata <- list.files(
pth, recursive = T, full.names = T, pattern = 'metadata.p'
) %>%
lapply(read_metadata) %>%
dplyr::bind_rows()
dplyr::left_join(err, metadata, by='model_id')
}
plot_all <- function(pth, ...) {
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'train') %>%
ggplot(aes(x=epoch, y=err, color=model_id)) +
geom_line()
}
read_file <- function() {
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
}
plot_all <- function(f_dir='~/projects/DroughtCast/data/model_results/unet/crop16/') {
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
}
f = fs[1]
f
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows()
d
f
f %>% basename() %>% stringr::str_split('_')
f %>% basename() %>% stringr::str_split('_') %>% unlist() %>% magrittr::extract(2)
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
dplyr::mutate(model_id =f %>% basename() %>%
stringr::str_split('_') %>%
unlist() %>% magrittr::extract(2)
)
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
dplyr::mutate(model_id =f %>% basename() %>%
stringr::str_split('_') %>%
unlist() %>% magrittr::extract(2)) %>%
tibble::rowid_to_column() %>%
dplyr::rename(epoch=rowid)
read_error <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
dplyr::mutate(model_id =f %>% basename() %>%
stringr::str_split('_') %>%
unlist() %>% magrittr::extract(2)) %>%
tibble::rowid_to_column() %>%
dplyr::rename(epoch=rowid)
}
fs %>% lapply(read_error)
0.00319 ** 0.5
0.00247 ** 0.5
raster::stack('./scratch/20070102_preds.tif')  %>% raster::plot()
library(magrittr)
raster::stack('./scratch/20070102_preds.tif')  %>% raster::plot()
raster::stack('./scratch/20070102_targets.tif')  %>% raster::plot()
raster::stack('./scratch/20070522_preds.tif')  %>% raster::plot()
raster::stack('./scratch/20070522_targets.tif')  %>% raster::plot()
library(magrittr)
raster::stack('./scratch/20070102_preds.tif')  %>% raster::plot()
raster::stack('./scratch/20070102_targets.tif')  %>% raster::plot()
library(reticulate)
library(magrittr)
library(ggplot2)
use_condaenv("gee", conda = "/opt/miniconda3/bin/conda")
source_python('~/projects/DroughtCast/crdm/utils/ReadPickle.py')
source('https://raw.githubusercontent.com/colinbrust/DroughtCast/revert/crdm/R/PlotTheme.R')
read_metadata <- function(f) {
read_pickle(f) %>%
lapply(function(x) paste(x, collapse=', ')) %>%
tibble::as_tibble() %>%
dplyr::mutate(across(!dplyr::starts_with('feats'), as.numeric)) %>%
dplyr::mutate(model_id = basename(dirname(f)))
}
read_error <- function(f) {
read_pickle(f) %>%
lapply(function(x) lapply(x, mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
dplyr::mutate(model_id =f %>% basename() %>%
stringr::str_split('_') %>%
unlist() %>% magrittr::extract(2)) %>%
tibble::rowid_to_column() %>%
dplyr::rename(epoch=rowid)
}
read_all <- function(pth) {
err <-  list.files(pth, recursive = T, full.names = T, pattern = 'err.p') %>%
lapply(read_error) %>%
dplyr::bind_rows()
metadata <- list.files(
pth, recursive = T, full.names = T, pattern = 'metadata.p'
) %>%
lapply(read_metadata) %>%
dplyr::bind_rows()
dplyr::left_join(err, metadata, by='model_id')
}
plot_all <- function(pth, ...) {
read_all(pth) %>%
tidyr::pivot_longer(c(train, test), names_to = 'set', values_to = 'err') %>%
dplyr::mutate(model_id = stringr::str_replace(model_id, 'model', '') %>%
as.numeric() %>%
factor()) %>%
dplyr::filter(set == 'train') %>%
ggplot(aes(x=epoch, y=err, color=model_id)) +
geom_line()
}
read_file <- function() {
read_pickle(f) %>%
lapply(function(x) lapply(x,mean)) %>%
lapply(tibble::as_tibble) %>%
dplyr::bind_rows() %>%
tibble::rowid_to_column() %>%
dplyr::mutate(f = basename(f)) %>%
}
plot_all <- function(f_dir='~/projects/DroughtCast/data/model_results/unet/crop16/') {
f_dir %>%
list.files(full.names = T, pattern = 'err.p') %>%
lapply(read_file) %>%
dplyr::bind_rows() %>%
dplyr::arrange(rerun, rowid) %>%
dplyr::select(-rowid) %>%
tibble::rowid_to_column() %>%
tidyr::pivot_longer(c(train, test), names_to='set') %>%
dplyr::mutate(batch = factor(batch),
hiddenSize = factor(hiddenSize),
nWeeks = factor(nWeeks)) %>%
ggplot(aes(x=rowid, y=value, color=set)) +
geom_line() +
labs(x='Epoch', y='MSE Loss', color='Train/Test Set') +
plot_theme()
}
list.files('~/projects/DroughtCast/data/models/tcn/model0/')
list.files('~/projects/DroughtCast/data/models/tcn/model0', full.names = T, pattern='err')
list.files('~/projects/DroughtCast/data/models/tcn/model0', full.names = T, pattern='err')
list.files('~/projects/DroughtCast/data/models/tcn/model0', full.names = T, pattern='err') %>% lapply(read_error)
raster::stack('~/projects/DroughtCast/data/models/tcn/preds/20030422_preds.tif') %>% raster::plot()
raster::stack('~/projects/DroughtCast/data/models/tcn/preds/20030422_targets.tif') %>% raster::plot()
read_error('./data/models/lstm/model1/err_0_lstm.p')
read_error('./data/models/lstm/model0/err_0_lstm.p')
read_error('./data/models/lstm/model1/err_1_lstm.p')
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_preds.tif') %>% raster::plot()
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_target.tif') %>% raster::plot()
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_targets.tif') %>% raster::plot()
read_error('./data/models/lstm/test/err_1_lstm.p')
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_target.tif') %>% raster::as.data.frame()
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_target.tif')
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_preds.tif')
raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_preds.tif') %>% raster::as.data.frame()
a = raster::stack('~/projects/DroughtCast/data/models/lstm/preds/20030805_preds.tif') %>% raster::rasterToPoints()
a
tibble::as_tibble(a)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, collapse='_')))
c('x', 'y', paste('lt', 1:12, collapse='_')
)
paste('lt', 1:12, collapse='_')
paste(1:12, 'a')
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep = ='_')))
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_')))
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>% tidyr::pivot_longer(dplyr::starts_with('lt_'))
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>% tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% ggplot(aes(x=x, y=y, fill=value)) + geom_raster() + facet_wrap(~name)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>% dplyr::mutate(value = round(value)) %>% tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% ggplot(aes(x=x, y=y, fill=value)) + geom_raster() + facet_wrap(~name)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% dplyr::mutate(value = round(value)) %>% ggplot(aes(x=x, y=y, fill=value)) + geom_raster() + facet_wrap(~name)
a
max(a$X20030805_preds.1)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% dplyr::mutate(value = round(value)) %$% hist(value)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% dplyr::mutate(value = round(value)) %>% dplyr::count(value)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %$% max(value)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %$% max(value)/5
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% dplyr::mutate(value = min(round(value), 5)) %$% hist(value)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% dplyr::mutate(value = round(value), value = ifelse(value >5, 5, value)) %>% dplyr::count(value)
tibble::as_tibble(a) %>% `colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%  tidyr::pivot_longer(dplyr::starts_with('lt_')) %>% dplyr::mutate(value = round(value), value = ifelse(value >5, 5, value)) %>% ggplot(aes(x=x, y=y, fill=value)) + geom_raster() + facet_wrap(~name)
tibble::as_tibble(a) %>%
`colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%
tidyr::pivot_longer(dplyr::starts_with('lt_')) %>%
dplyr::mutate(value = round(value),
value = ifelse(value >5, 5, value),
value = dplyr::recode(
value,
`0` = 'No Drought',
`1` = 'D0',
`2` = 'D1',
`3` = 'D2',
`4` = 'D3',
`5` = 'D4')) %>%
ggplot(aes(x=x, y=y, fill=value)) + geom_raster() + facet_wrap(~name)
tibble::as_tibble(a) %>%
`colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%
tidyr::pivot_longer(dplyr::starts_with('lt_')) %>%
dplyr::mutate(value = round(value),
value = ifelse(value >5, 5, value),
value = dplyr::recode(
value,
`0` = 'No Drought',
`1` = 'D0',
`2` = 'D1',
`3` = 'D2',
`4` = 'D3',
`5` = 'D4')) %>%
ggplot(aes(x=x, y=y, fill=value)) +
geom_raster() +
facet_wrap(~name) +
scale_fill_manual(values = c('No Drought' = NA,
'D0' = '#FFFF00',
'D1' = '#FCD37F',
'D2' = '#FFAA00',
'D3' = '#E60000',
'D4' = '#730000')) +
plot_theme()
raster::stack('./data/models/lstm/preds/20030805_preds.tif') %>% raster::rasterToPoints() %>% tibble::as_tibble() %>%
`colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%
tidyr::pivot_longer(dplyr::starts_with('lt_')) %>%
dplyr::mutate(value = round(value),
value = ifelse(value >5, 5, value),
value = dplyr::recode(
value,
`0` = 'No Drought',
`1` = 'D0',
`2` = 'D1',
`3` = 'D2',
`4` = 'D3',
`5` = 'D4')) %>%
ggplot(aes(x=x, y=y, fill=value)) +
geom_raster() +
facet_wrap(~name) +
scale_fill_manual(values = c('No Drought' = NA,
'D0' = '#FFFF00',
'D1' = '#FCD37F',
'D2' = '#FFAA00',
'D3' = '#E60000',
'D4' = '#730000')) +
plot_theme()
raster::stack('./data/models/lstm/preds/20030805_targets.tif') %>% raster::rasterToPoints() %>% tibble::as_tibble() %>%
`colnames<-`(c('x', 'y', paste('lt', 1:12, sep ='_'))) %>%
tidyr::pivot_longer(dplyr::starts_with('lt_')) %>%
dplyr::mutate(value = round(value),
value = ifelse(value >5, 5, value),
value = dplyr::recode(
value,
`0` = 'No Drought',
`1` = 'D0',
`2` = 'D1',
`3` = 'D2',
`4` = 'D3',
`5` = 'D4')) %>%
ggplot(aes(x=x, y=y, fill=value)) +
geom_raster() +
facet_wrap(~name) +
scale_fill_manual(values = c('No Drought' = NA,
'D0' = '#FFFF00',
'D1' = '#FCD37F',
'D2' = '#FFAA00',
'D3' = '#E60000',
'D4' = '#730000')) +
plot_theme()
raster::raster('./data/in_features/tif/constant/pr-const.tif')
raster::raster('./data/in_features/tif/constant/pr-const.tif') %>% raster::plot()
raster::raster('./data/in_features/tif/constant/pr-const.tif') -> a
a[!is.na(a)] = 1
a[is.na(a)] = 0
raster::plot(a)
raster::writeRaster(a, './data/in_features/pix_mask.tif')
